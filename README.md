# Pyenv pyright plugin

Configure [Microsoft Pyright](https://github.com/microsoft/pyright) for your projects when using [pyenv](https://github.com/pyenv/pyenv).

## Install

```sh
git clone https://github.com/kassick/pyenv-pyright.git $(pyenv root)/plugins/pyenv-pyright
```

## Usage

- `pyenv pyright --help`: display the help message

        Usage: pyenv pyright [OPTIONS] [version]

          -o file        Output file [default: pyrightconfig.json]

          version        The pyenv's python version or virtualenv to be used

- `pyenv pyright`: creates or updates `pyrightconfig.json` using the current python executable.

- `pyenv pyright some_venv_or_version`: updates or creates the `pyrightconfig.json` using the python version specified by `some_env`.

- `pyenv pyright -o some_file`: updates or creates `some_file` instead of `pyrightconfig.json`. A value of `-` prints the contents to `stdout`.

## Examples

    $ pyenv pyright -o - system

Output:

      {
          "python": {
              "pythonPath": "/usr/bin/python3.10"
          },
          "extraPaths": [
              "/usr/lib64/python310.zip",
              "/usr/lib64/python3.10",
              "/usr/lib64/python3.10/lib-dynload",
              "/home/me/.local/lib/python3.10/site-packages",
              "/usr/lib64/python3.10/site-packages",
              "/usr/lib/python3.10/site-packages"
          ]
      }

---

    $ pyenv install 3.8.10
    $ pyenv pyright -o - 3.8.10

Output:

      {
          "python": {
              "pythonPath": "/home/me/.pyenv/versions/3.8.10/bin/python3.8"
          },
          "extraPaths": [
              "/home/me/.pyenv/versions/3.8.10/lib/python38.zip",
              "/home/me/.pyenv/versions/3.8.10/lib/python3.8",
              "/home/me/.pyenv/versions/3.8.10/lib/python3.8/lib-dynload",
              "/home/me/.local/lib/python3.8/site-packages",
              "/home/me/.pyenv/versions/3.8.10/lib/python3.8/site-packages"
          ]
      }

---

    $ mkdir my_project
    $ cd my_project
    $ pyenv virtualenv 3.8.10 someenv
    $ pyenv local someenv
    $ pyenv pyright
    $ cat pyrightconfig.json

Output:

    {
        "python": {
            "pythonPath": "/home/me/.pyenv/versions/3.8.10/bin/python3.8"
        },
        "extraPaths": [
            "/home/me/.pyenv/versions/3.8.10/lib/python37.zip",
            "/home/me/.pyenv/versions/3.8.10/lib/python3.8",
            "/home/me/.pyenv/versions/3.8.10/lib/python3.8/lib-dynload",
            "/home/me/.pyenv/versions/libbia/lib/python3.8/site-packages"
        ]
    }

## Why

### Why not `venv` and `venvPath` ?

`pyright` has `venv` and `venvPath` settings that are way more simple than adding all necessary search paths to the config file.

Sadly, that's not enough.

Consider a python `3.8.10` virtualenv called `myenv`. With some pyrightconfig.json like

    {
        "venvPath": "/home/me/.pyenv/versions",
        "venv": "myenv"
    }

pyright will find the `python` executable at `/home/me/.pyenv/versions/myenv/` and all packages installed in `myenv`, but then it fails to find the system packages under `versions/myenv` (because the the system packages actually are under `versions/3.8.10`).

Pyright then will fallback to it's typeshed fallback when doing completions, hover, etc.

Consider the following code, with cursor right after the dot:

```python
import subprocess
result = subprocess.r|
```

Asking for completions will correctly suggest `run`, but the completions will come from `pyright/dist/typeshed-fallback/stdlib/subprocess.pyi`. And since this file has no docstring (only several `@overload` of `run`), any documentation returned on hover will consist only of the many overloads of the function and none of the original docstrings.

Using a config file generated by this plugin, pyright correctly locates `subprocess.py` under `versions/3.8.10/` -- and any package installed in `myenv`


### Why not the other pyenv-pyright plugin?

There's already a plugin named [pyenv-pyright](https://github.com/alefpereira/pyenv-pyright) that adjusts the pyrightconfig file with the `venv` and `venvPath` entries.

Mostly, I felt that adjusting that plugin would produce too many changes, so I preferred a clean-slate implementation.
